/**
Created By: MICP-ICT
*/
$(window).on('load', function(){
	// Asynchronous Sign Up

	//instantiations
	var orangeForm_username=$("#orangeForm-username"), 
		orangeForm_email=$("#orangeForm-email"),
		orangeForm_pass=$("#orangeForm-pass"),
		orangeForm_confirm_pass = $("#orangeForm_confirm_pass")
		status_username=false, status_email=false, status_pass=false
		status_confirm_pass=false;
	//instantiations
	//returns true if requirements have been met
	function username_filter(username){
		var allDigits = /^[0-9]+$/g,
        allHyphens = /^[-]+$/g, //doesn't need a character class, but I find it's more readable
        multiHyphens = /[-]+/g,
        startsWith = /^[A-Za-z0-9]{1}/,
        endsWith = /[A-Za-z0-9]{1}$/
        hasInvalidChars = /[^A-Za-z0-9-]/,
        meetsReqs = false;
    	if (username.length >= 8 && username.length <= 17) { //ensure correct length
        	meetsReqs = !allDigits.test(username);
        	meetsReqs = meetsReqs && !allHyphens.test(username);
        	meetsReqs = meetsReqs && !multiHyphens.test(username);
        	meetsReqs = meetsReqs && !hasInvalidChars.test(username);
        	meetsReqs = meetsReqs && startsWith.test(username);
        	meetsReqs = meetsReqs && endsWith.test(username);
    	}
    	
    	return meetsReqs;
	}
	//validate username length and pattern
	orangeForm_username.on('keyup',function(){
	    orangeForm_username.siblings('label').text('Username').attr('class','').addClass('indigo-text')
		if(username_filter(orangeForm_username.val())==false){
			orangeForm_username.siblings('label').text('Username is invalid').attr('class','').addClass('red-text');
			status_username=false;
		}
		else{
			orangeForm_username.siblings('label').text('Username is valid').attr('class','').addClass('green-text');
			status_username=true;
		}
	})
	//do ajax validation for username uniqueness
	orangeForm_username.focusout(function(){
		var url=orangeForm_username.attr('data-url')
		$.ajax({
			url:url,
			data:{username:orangeForm_username.val()},
			success: function(data){
				status_username = data.status.toLowerCase() == 'true' ? true : false;   //returns true
				orangeForm_username.siblings('label').attr('class', data.class)
				orangeForm_username.siblings('label').val(data.message)
			},
			error: function(data){
				console.log('There was an error in the server...');
			}
		})
		
	})
	//validate email
	function email_filter(email){
		var reg_email = /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
		return reg_email.test(email);
	}

	orangeForm_email.focusout(function(){
		if(email_filter(orangeForm_email.val())){
			orangeForm_email.siblings('label').text('This is a valid email').attr('class','green-text')
		}
		else{
			orangeForm_email.siblings('label').text('Invalid email').attr('class','red-text')
		}
	})

	//measures password strength
	function mete_password(password){
		//do nothing if password length is zero
		if(password.length==0){
			return 0;
		}
		// Create an array and push all possible values that you want in password
        var matchedCase = new Array();
        matchedCase.push("[$@$!%*#?&]"); // Special Charector
        matchedCase.push("[A-Z]");      // Uppercase Alpabates
        matchedCase.push("[0-9]");      // Numbers
        matchedCase.push("[a-z]");     // Lowercase Alphabates

    	// Check the conditions
        var ctr = 0;
        for (var i = 0; i < matchedCase.length; i++) {
            if (new RegExp(matchedCase[i]).test(password)) {
                 ctr++;
            }
        }
        return ctr;

	}
	orangeForm_pass.focusout(function(){
	    passwordStrength=mete_password(orangeForm_pass.val());
		console.log(passwordStrength)
		switch(passwordStrength){
			case 0:case 1: case 2:
				orangeForm_pass.siblings('label').text('Weak Password').attr('class','red-text'); break;
			case 3: 
				orangeForm_pass.siblings('label').text('Fairly Strong Password').attr('class','orange-text'); break;
			case 4:
				orangeForm_pass.siblings('label').text('Strong Password').attr('class','green-text'); break;
		}		

	})
	//submit credentials upon successful validation
	$("#SignUpFormBtn").click(function(){
		//check for validation failure
		switch(false){
			case status_username: return false; break;
			case status_pass:return false; break;
			case status_email: return false; break;
			case status_confirm_pass: return false;
		}
	})
})